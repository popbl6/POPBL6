create or replace function ikusTel()
returns setof record
as $$
select idCI,Deskribapena,jabea,aeKapa,Marka,modeloa,serieZenbakia,Oharrak,extensioa,TelefonoZki
from ci where idmota=(Select idMota from motak where mota='telefonoak');
$$ language sql;

create or replace function ikusKontrat()
returns setof record
as $$
select idCI,deskribapena,idMota,aekapa,oharrak,kontratuAmaiera,kontaktua,sinatzailea
from ci where idmota=(Select idMota from motak where mota='kontratuak');
$$ language sql;

create or replace function ikusSoft()
returns setof record
as $$
select idCI,Deskribapena,jabea,aeKapa,Marka,Bertsioa,serieZenbakia,oharrak
from ci where idmota=(Select idMota from motak where mota='Software');
$$ language sql;

create or replace function ikusPC()
returns setof record
as $$
select idCI,Deskribapena,jabea,aeKapa,Marka,Prozesagailua,Ram,diskoGogorra,modeloa,serieZenbakia,Oharrak
from ci where idmota=(Select idMota from motak where mota='ordenagailuak');
$$ language sql;

create or replace function ikusKomLin()
returns setof record
as $$
select idCI,Deskribapena,aeKapa,Oharrak,abiadura,isp
from ci where idmota=(Select idMota from motak where mota='Komunikazio lineak');
$$ language sql;


create or replace function InzidentziaSortu(integer,text,integer,integer)
returns void
as $$
insert into inzidentziak(inzidentziaHasi,timestamp,DeskribapenaArazo,idCi,inzidentziaMota,konponduta) values($1,now()::timestamp,$2,$3,$4,false)
$$ language sql;

create or replace function InzidentziaItxi(integer,text,integer)
returns void
as $$
update inzidentziak set inzidentziaItxi=$1,deskribapenaKonpon=$2,konponduta=true where idInzidentziak=$3;
$$ language sql;

create or replace function checkUser(int,text)
returns integer
as $$
select idDepartamentua from Langileak where idLangileak = $1 and pasahitza = $2;
$$language sql;

create or replace function motak()
returns setof record
as $$
select * from motak;
$$language sql;

create or replace function checkCI(integer)
returns boolean
as $$
DECLARE
	cur cursor for select * from CI;
	r record;
BEGIN
	open cur;
	fetch cur into r;
	while found loop
	if r.idCI=$1 then
return true;
	end if;
	fetch cur into r;
	end loop; 
return false;
	close cur;
END
$$ language plpgsql;